{% extends 'base.html.twig' %}

{% block title %}Tournois
{% endblock %}

{% block body %}
	<section class="tournament-hero">
		<div class="overlay"></div>
		<div class="hero-content">
			<h1>Liste des Tournois</h1>
			<p>Affronte dâ€™autres challengers et prouve ta valeur dans lâ€™arÃ¨ne ğŸ”¥</p>
		</div>
	</section>

	<section class="tournament-list">
		{% if tournaments is empty %}
			<p class="no-tournament">Aucun tournoi disponible pour le moment âš”ï¸</p>
		{% else %}
			<div class="tournament-grid">
				{% for tournament in tournaments %}
					<div class="tournament-card">
						<a href="{{ path('app_tournament_show', { id: tournament.id }) }}" class="card-link">
							<div class="tournament-img">
								<img src="{{ tournament.image ? asset('img/tournaments/' ~ tournament.image) }}" alt="Image du tournoi {{ tournament.name }}">
							</div>

							<div class="tournament-info">
								<h2>{{ tournament.name }}</h2>
								<p class="location">ğŸ“
									{{ tournament.location }}</p>
								<p class="date">ğŸ“…
									{{ tournament.date|date('d/m/Y') }}</p>
							</div>
						</a>

						<div class="tournament-actions">

    {% if app.user %}

        {# ğŸ” On rÃ©cupÃ¨re la participation Ã©ventuelle de l'utilisateur #}
        {% set p = tournament.tournamentParticipants|filter(p => p.user == app.user)|first %}

        {# ğŸ§‘â€âš–ï¸ L'utilisateur est arbitre #}
        {% if app.user in tournament.referees %}
            <p>ğŸ‘¨â€âš–ï¸ Vous Ãªtes arbitre de ce tournoi.</p>

        {# ğŸ•“ PrÃ©-inscrit mais pas encore validÃ© #}
        {% elseif p and p.isPending and not p.isApproved %}
            <button class="btn-pending" disabled>â³ PrÃ©-inscription en attente</button>

        {# ğŸ’° ValidÃ© par admin mais paiement pas confirmÃ© #}
        {% elseif p and p.isApproved and not p.isPaid %}
            <button class="btn-warning" disabled>ğŸ’° Paiement en attente</button>

        {# âœ”ï¸ ValidÃ© + payÃ© â†’ vrai inscrit #}
        {% elseif p and p.isApproved and p.isPaid %}
            <button class="btn-joined" disabled>Inscription confirmÃ©e âœ”ï¸</button>

        {# âŒ PrÃ©-inscriptions complÃ¨tes (80 max) #}
        {% elseif tournament.tournamentParticipants|filter(pp => pp.isPending)|length >= 80 %}
            <button class="btn-disabled" disabled>âŒ PrÃ©-inscriptions fermÃ©es (80 / 80)</button>

        {# ğŸ”¥ Nouvelle prÃ©-inscription #}
        {% else %}
            <a href="{{ path('app_tournament_pre_register', { id: tournament.id }) }}" class="btn-join">
                Sâ€™inscrire (prÃ©-inscription) ğŸ”¥
            </a>
        {% endif %}

    {% else %}
        <a href="{{ path('app_login') }}" class="btn-login-neon">Se connecter</a>
    {% endif %}

</div>


					</div>
				{% endfor %}
			</div>
		{% endif %}
	</section>
{% endblock %}
