{% extends 'base.html.twig' %}

{% block body %}
<section class="match-view">
    <h1 class="match-title">
        ‚öîÔ∏è Match #{{ match.id }}  
        <span>{{ match.player1.userIdentifier }}</span> vs <span>{{ match.player2.userIdentifier }}</span>
    </h1>

    <div class="hp-container">
        <div class="player">
            <h3>{{ match.player1.userIdentifier }}</h3>
            <div class="hp-bar">
                <div class="hp-fill" style="width: {{ match.score1 }}%;"></div>
            </div>
            <p class="hp-text">{{ match.score1 }} HP</p>
        </div>

        <div class="player">
            <h3>{{ match.player2.userIdentifier }}</h3>
            <div class="hp-bar">
                <div class="hp-fill" style="width: {{ match.score2 }}%;"></div>
            </div>
            <p class="hp-text">{{ match.score2 }} HP</p>
        </div>
    </div>

    <h2 class="section-title">üé¥ Vos cartes disponibles</h2>

    <div class="cards-grid">
        {% if availableCards is not empty %}
            {% for card in availableCards %}
                <div class="match-card">
                    <h4 class="card-name">{{ card.card.name }}</h4>
                    <p class="card-effect">{{ card.card.effect }}</p>
                    <p class="card-quantity">Quantit√© : {{ card.quantity }}</p>

                    <form method="POST" action="{{ path('app_tournament_match_use_card', {
                        tournamentId: tournament.id,
                        id: match.id,
                        cardId: card.card.id
                    }) }}">
                        <input type="hidden" name="_token" value="{{ csrf_token('use_card_' ~ card.id) }}">
                        <button type="submit" class="btn-activate">Activer</button>
                    </form>

                    {% for label, messages in app.flashes %}
                        {% for message in messages %}
                            <div class="alert alert-{{ label }}">{{ message }}</div>
                        {% endfor %}
                    {% endfor %}
                </div>
            {% endfor %}
        {% else %}
            <p class="empty-text">Aucune carte disponible pour vous.</p>
        {% endif %}
    </div>

    <h2 class="section-title">ü™Ñ Cartes utilis√©es pendant le match</h2>

<div class="used-cards-grid">
    {% if usedCards is not empty %}
        {% for play in usedCards %}
            <div class="used-card">
                <p class="used-card-name">{{ play.card.name }}</p>
                <p class="used-card-info">
                    Utilis√©e par 
                    <span class="used-by">
                        {{ play.usedBy.userIdentifier }}
                    </span>
                    √† {{ play.usedAt|date('H:i') }}
                </p>
            </div>
        {% endfor %}
    {% else %}
        <p class="empty-text">Aucune carte utilis√©e pour le moment.</p>
    {% endif %}
</div>


    <a href="{{ path('app_tournament_show', {id: tournament.id}) }}" class="btn-back">‚Üê Retour au tournoi</a>
</section>
{% endblock %}
