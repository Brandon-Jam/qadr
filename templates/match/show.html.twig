{% extends 'base.html.twig' %}

{% block body %}
<section class="match-view">
    <h1 class="match-title"> 
        <span>{{ match.player1.user.email }}</span> vs <span>{{ match.player2.user.email }}</span>
    </h1>

    <div class="hp-container">
        <div class="player">
            <h3>{{ match.player1.user.email }}</h3>
            <div class="hearts">
    {% for i in 1..3 %}
        {% if i <= match.score1 %}
            <span class="heart full">â¤ï¸</span>
        {% else %}
            <span class="heart empty">ğŸ¤</span>
        {% endif %}
    {% endfor %}
</div>
            
        </div>

        <div class="player">
            <h3>{{ match.player2.user.Email }}</h3>
            <div class="hp-bar">
                <div class="hp-fill" style="width: {{ match.score2 is not null ? match.score2 : 0 }}%;"></div>
            </div>
            <p class="hp-text">
                {% if match.score2 is not null %}
                    {{ match.score2 }} HP
                {% else %}
                    HP non dÃ©fini
                {% endif %}
            </p>
        </div>
    </div>

    {# --- Affichage du score + statut du match --- #}
    {% if match.score1 is not null and match.score2 is not null %}
        <div class="match-score neon-text">
            <p>Score : {{ match.score1 }} - {{ match.score2 }}</p>
            {% if match.winner %}
                <p>ğŸ† Vainqueur : {{ match.winner.user.email }}</p>
            {% else %}
                <p>âš”ï¸ Match en attente de rÃ©sultat</p>
            {% endif %}
        </div>
    {% else %}
        <p class="match-score neon-text">âš”ï¸ Match en attente de rÃ©sultat</p>
    {% endif %}

    {# --- Formulaire pour le referee : saisie des scores --- #}
    {% if is_granted('ROLE_REFEREE') or match.tournament.referees.contains(app.user) %}
        <form method="post" class="score-form">
            <input type="hidden" name="action" value="score">
            <div class="score-inputs">
                <label>{{ match.player1.user.email }} :</label>
                <input type="number" name="score1" min="0" value="{{ match.score1 ?? '' }}">

                <label>{{ match.player2.user.email }} :</label>
                <input type="number" name="score2" min="0" value="{{ match.score2 ?? '' }}">

                <button type="submit" class="btn btn-neon">ğŸ’¾ Enregistrer les scores</button>
            </div>
        </form>
    {% endif %}

    <h2 class="section-title">ğŸ´ Vos cartes disponibles</h2>

    

    <h2 class="section-title">ğŸª„ Cartes utilisÃ©es pendant le match</h2>

    
    {# --- Validation finale du match (referee only) --- #}
    {% if (is_granted('ROLE_REFEREE') or match.tournament.referees.contains(app.user)) and not match.isValidated %}
        <form method="post" class="validate-form">
            <input type="hidden" name="action" value="validate">
            <button type="submit" class="btn btn-neon">âœ… Valider le match</button>
        </form>
    {% endif %}

    <a href="{{ path('app_tournament_show', {id: tournament.id}) }}" class="btn-back">â† Retour au tournoi</a>
</section>
{% endblock %}
