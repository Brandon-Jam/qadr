{% extends 'base.html.twig' %}

{% block title %}Matchs du tournoi{% endblock %}

{% block body %}
<section class="match-list-section">
    <h1 class="page-title">üèÜ Matchs du tournoi : {{ tournament.name }}</h1>
    <p class="tournament-info">üìç {{ tournament.location }} | üóì {{ tournament.date|date('d/m/Y H:i') }}</p>

    {% if matches is empty %}
        <p class="empty-text">Aucun match n‚Äôa encore √©t√© enregistr√© pour ce tournoi.</p>
    {% else %}

        {# ===================== MATCHS √Ä JOUER ===================== #}
        <h2 class="section-title">üïê Matchs √† jouer</h2>
        <div class="matches-grid">
            {% set hasPending = false %}
            {% for match in matches %}
                {% if match.score1 is null and match.score2 is null %}
                    {% set hasPending = true %}
                    <div class="match-card">
                        <div class="player-card player-left">
                            <div class="avatar neon-avatar-blue">
                                <img src="{{ asset('img/avatars/' ~ match.player1.avatar|default('default.png')) }}" alt="">
                            </div>
                            <h3>{{ match.player1.userIdentifier }}</h3>
                        </div>

                        <div class="vs-circle">VS</div>

                        <div class="player-card player-right">
                            <div class="avatar neon-avatar-pink">
                                <img src="{{ asset('img/avatars/' ~ match.player2.avatar|default('default.png')) }}" alt="">
                            </div>
                            <h3>{{ match.player2.userIdentifier }}</h3>
                        </div>

                        <div class="match-footer">
                            <p class="status text-warning">√Ä jouer</p>
                            <a href="{{ path('app_tournament_match_show', {tournamentId: tournament.id, id: match.id}) }}" class="btn-view">Voir</a>
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
            {% if not hasPending %}
                <p class="empty-text">Aucun match √† jouer.</p>
            {% endif %}
        </div>

        <hr class="section-separator">

        {# ===================== MATCHS EN COURS ===================== #}
        <h2 class="section-title">‚öîÔ∏è Matchs en cours</h2>
        <div class="matches-grid">
            {% set hasActive = false %}
            {% for match in matches %}
                {% if match.score1 is not null and match.score2 is not null and match.score1 > 0 and match.score2 > 0 %}
                    {% set hasActive = true %}
                    <div class="match-card">
                        <div class="player-card player-left">
                            <div class="avatar neon-avatar-blue">
                                <img src="{{ asset('img/avatars/' ~ match.player1.avatar|default('default.png')) }}" alt="">
                            </div>
                            <h3>{{ match.player1.userIdentifier }}</h3>
                            <p class="score">{{ match.score1 }} HP</p>
                        </div>

                        <div class="vs-circle">VS</div>

                        <div class="player-card player-right">
                            <div class="avatar neon-avatar-pink">
                                <img src="{{ asset('img/avatars/' ~ match.player2.avatar|default('default.png')) }}" alt="">
                            </div>
                            <h3>{{ match.player2.userIdentifier }}</h3>
                            <p class="score">{{ match.score2 }} HP</p>
                        </div>

                        <div class="match-footer">
                            <p class="status text-info">En cours</p>
                            <a href="{{ path('app_tournament_match_show', {tournamentId: tournament.id, id: match.id}) }}" class="btn-view">Voir</a>
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
            {% if not hasActive %}
                <p class="empty-text">Aucun match en cours.</p>
            {% endif %}
        </div>

        <hr class="section-separator">

        {# ===================== MATCHS TERMIN√âS ===================== #}
        <h2 class="section-title">üèÅ Matchs termin√©s</h2>
        <div class="matches-grid">
            {% set hasFinished = false %}
            {% for match in matches %}
                {% if match.score1 is not null and match.score2 is not null and (match.score1 == 0 or match.score2 == 0) %}
                    {% set hasFinished = true %}
                    {% set winner = match.score1 > match.score2 ? match.player1 : match.player2 %}
                    {% set loser = match.score1 > match.score2 ? match.player2 : match.player1 %}

                    <div class="match-card match-finished">
                        <div class="player-card player-left {% if winner.id == match.player1.id %}winner{% else %}loser{% endif %}">
                            <div class="avatar {% if winner.id == match.player1.id %}neon-avatar-blue{% else %}avatar-gray{% endif %}">
                                <img src="{{ asset('img/avatars/' ~ match.player1.avatar|default('default.png')) }}" alt="">
                            </div>
                            <h3>{{ match.player1.userIdentifier }}</h3>
                            <p class="score">{{ match.score1 }} HP</p>
                            <p class="result-label">
                                {% if winner.id == match.player1.id %}üèÜ Gagnant{% else %}‚ùå Perdant{% endif %}
                            </p>
                        </div>

                        <div class="vs-circle">VS</div>

                        <div class="player-card player-right {% if winner.id == match.player2.id %}winner{% else %}loser{% endif %}">
                            <div class="avatar {% if winner.id == match.player2.id %}neon-avatar-pink{% else %}avatar-gray{% endif %}">
                                <img src="{{ asset('img/avatars/' ~ match.player2.avatar|default('default.png')) }}" alt="">
                            </div>
                            <h3>{{ match.player2.userIdentifier }}</h3>
                            <p class="score">{{ match.score2 }} HP</p>
                            <p class="result-label">
                                {% if winner.id == match.player2.id %}üèÜ Gagnant{% else %}‚ùå Perdant{% endif %}
                            </p>
                        </div>

                        <div class="match-footer">
                            <p class="status text-success">Termin√©</p>
                            <a href="{{ path('app_tournament_match_show', {tournamentId: tournament.id, id: match.id}) }}" class="btn-view">D√©tails</a>
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
            {% if not hasFinished %}
                <p class="empty-text">Aucun match termin√©.</p>
            {% endif %}
        </div>

    {% endif %}
</section>
{% endblock %}
