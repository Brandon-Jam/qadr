{% extends 'base.html.twig' %}

{% block title %}Matchs du tournoi{% endblock %}

{% block body %}
<section class="match-list-section">
    {% if app.request.query.get('notActive') %}
    <div class="flash flash-warning">
        ğŸš§ Le tournoi nâ€™est pas encore lancÃ©. Reviens quand il sera activÃ© !
    </div>
{% endif %}
    <h1 class="page-title">ğŸ† Matchs du tournoi : {{ tournament.name }}</h1>
    <p class="tournament-info">
        ğŸ“ {{ tournament.location }} |
        ğŸ—“ {{ tournament.date|date('d/m/Y H:i') }}
    </p>

    {% if app.user in tournament.referees %}
        <p>ğŸ‘¨â€âš–ï¸ Vous Ãªtes arbitre de ce tournoi.</p>
    {% endif %}

    

        {# ===================== EN COURS ===================== #}
        <h2 class="section-title">âš”ï¸ Matchs en cours</h2>
        <div class="matches-grid">

            {% set hasActive = false %}
            {% for match in activeMatches  %}
                {% if match.score1 is not null and match.score2 is not null and match.score1 > 0 and match.score2 > 0 %}
                    {% set hasActive = true %}

                    <div class="match-card">
                        <div class="match-row">

                            <div class="player-side">
                                <div class="avatar neon-avatar-blue">
                                    <img src="{{ asset('img/avatars/' ~ match.player1.user.avatar|default('default.png')) }}" alt="">
                                </div>
                                <p class="player-name">{{ match.player1.user.pseudo }}</p>
                                <p class="player-hp">{{ match.score1 }} HP</p>
                            </div>

                            <div class="vs-circle">VS</div>

                            <div class="player-side">
                                <div class="avatar neon-avatar-pink">
                                    <img src="{{ asset('img/avatars/' ~ match.player2.user.avatar|default('default.png')) }}" alt="">
                                </div>
                                <p class="player-name">{{ match.player2.user.pseudo }}</p>
                                <p class="player-hp">{{ match.score2 }} HP</p>
                            </div>

                        </div>

                        <div class="match-footer">
                            <p class="status text-info">En cours</p>
                            <a href="{{ path('app_tournament_match_show', {tournamentId: tournament.id, id: match.id}) }}" class="btn-view">Voir</a>
                        </div>

                    </div>
                {% endif %}
            {% endfor %}

            {% if not hasActive %}
                <p class="empty-text">Aucun match en cours.</p>
            {% endif %}
        </div>

        <hr class="section-separator">


        {# ===================== TERMINÃ‰S ===================== #}
        <h2 class="section-title">ğŸ Matchs terminÃ©s</h2>
        <div class="matches-grid">

            {% set hasFinished = false %}
            {% for match in finishedMatches  %}
                {% if match.score1 is not null and match.score2 is not null and (match.score1 == 0 or match.score2 == 0) %}

                    {% set hasFinished = true %}
                    {% set winner = match.score1 > match.score2 ? match.player1 : match.player2 %}
                    {% set loser  = match.score1 > match.score2 ? match.player2 : match.player1 %}

                    <div class="match-card match-finished">
                        <div class="match-row">

                            {# PLAYER 1 #}
                            <div class="player-side {% if winner.id == match.player1.id %}winner{% else %}loser{% endif %}">
                                <div class="avatar {% if winner.id == match.player1.id %}neon-avatar-blue{% else %}avatar-gray{% endif %}">
                                    <img src="{{ asset('img/avatars/' ~ match.player1.user.avatar|default('default.png')) }}">
                                </div>
                                <p class="player-name">{{ match.player1.user.pseudo }}</p>
                                <p class="player-hp">{{ match.score1 }} HP</p>
                                <p class="result-label">
                                    {% if winner.id == match.player1.id %}ğŸ† Gagnant{% else %}âŒ Perdant{% endif %}
                                </p>
                            </div>

                            <div class="vs-circle">VS</div>

                            {# PLAYER 2 #}
                            <div class="player-side {% if winner.id == match.player2.id %}winner{% else %}loser{% endif %}">
                                <div class="avatar {% if winner.id == match.player2.id %}neon-avatar-pink{% else %}avatar-gray{% endif %}">
                                    <img src="{{ asset('img/avatars/' ~ match.player2.user.avatar|default('default.png')) }}">
                                </div>
                                <p class="player-name">{{ match.player2.user.pseudo }}</p>
                                <p class="player-hp">{{ match.score2 }} HP</p>
                                <p class="result-label">
                                    {% if winner.id == match.player2.id %}ğŸ† Gagnant{% else %}âŒ Perdant{% endif %}
                                </p>
                            </div>

                        </div>

                        <div class="match-footer">
                            <p class="status text-success">TerminÃ©</p>
                            <a href="{{ path('app_tournament_match_show', {tournamentId: tournament.id, id: match.id}) }}" class="btn-view">DÃ©tails</a>
                        </div>

                    </div>

                {% endif %}
            {% endfor %}

            {% if not hasFinished %}
                <p class="empty-text">Aucun match terminÃ©.</p>
            {% endif %}

        </div>
   
</section>
{% endblock %}
