{% extends 'base.html.twig' %}

{% block title %}Matchs du tournoi{% endblock %}

{% block body %}
<section class="match-list-section">

    <h1 class="page-title">üèÜ Matchs du tournoi : {{ tournament.name }}</h1>
    <p class="tournament-info">
        üìç {{ tournament.location }} |
        üóì {{ tournament.date|date('d/m/Y H:i') }}
    </p>

    {% if app.user in tournament.referees %}
        <p>üë®‚Äç‚öñÔ∏è Vous √™tes arbitre de ce tournoi.</p>
    {% endif %}

    {% if matches is empty %}
        <p class="empty-text">Aucun match n‚Äôa encore √©t√© enregistr√© pour ce tournoi.</p>
    {% else %}

        {# ===================== √Ä JOUER ===================== #}
        <h2 class="section-title">üïê Matchs √† jouer</h2>
        <div class="matches-grid">

            {% set hasPending = false %}
            {% for match in matches %}
                {% if match.score1 is null and match.score2 is null %}
                    {% set hasPending = true %}

                    <div class="match-card">
                        <div class="match-row">

                            {# --- PLAYER 1 --- #}
                            <div class="player-side">
                                <div class="avatar neon-avatar-blue">
                                    <img src="{{ asset('img/avatars/' ~ match.player1.avatar|default('default.png')) }}" alt="">
                                </div>
                                <p class="player-name">{{ match.player1.user.pseudo }}</p>
                            </div>

                            <div class="vs-circle">VS</div>

                            {# --- PLAYER 2 --- #}
                            <div class="player-side">
                                <div class="avatar neon-avatar-pink">
                                    <img src="{{ asset('img/avatars/' ~ match.player2.avatar|default('default.png')) }}" alt="">
                                </div>
                                <p class="player-name">{{ match.player2.user.pseudo }}</p>
                            </div>

                        </div>

                        <div class="match-footer">
                            <p class="status text-warning">√Ä jouer</p>

                            {% if app.user in tournament.referees %}
                                <a href="{{ path('app_tournament_match_show', {tournamentId: tournament.id, id: match.id}) }}" class="btn-manage">Manager</a>
                            {% else %}
                                <a href="{{ path('app_tournament_match_show', {tournamentId: tournament.id, id: match.id}) }}" class="btn-view">Voir</a>
                            {% endif %}
                        </div>
                    </div>

                {% endif %}
            {% endfor %}

            {% if not hasPending %}
                <p class="empty-text">Aucun match √† jouer.</p>
            {% endif %}
        </div>

        <hr class="section-separator">


        {# ===================== EN COURS ===================== #}
        <h2 class="section-title">‚öîÔ∏è Matchs en cours</h2>
        <div class="matches-grid">

            {% set hasActive = false %}
            {% for match in matches %}
                {% if match.score1 is not null and match.score2 is not null and match.score1 > 0 and match.score2 > 0 %}
                    {% set hasActive = true %}

                    <div class="match-card">
                        <div class="match-row">

                            <div class="player-side">
                                <div class="avatar neon-avatar-blue">
                                    <img src="{{ asset('img/avatars/' ~ match.player1.avatar|default('default.png')) }}" alt="">
                                </div>
                                <p class="player-name">{{ match.player1.user.pseudo }}</p>
                                <p class="player-hp">{{ match.score1 }} HP</p>
                            </div>

                            <div class="vs-circle">VS</div>

                            <div class="player-side">
                                <div class="avatar neon-avatar-pink">
                                    <img src="{{ asset('img/avatars/' ~ match.player2.avatar|default('default.png')) }}" alt="">
                                </div>
                                <p class="player-name">{{ match.player2.user.pseudo }}</p>
                                <p class="player-hp">{{ match.score2 }} HP</p>
                            </div>

                        </div>

                        <div class="match-footer">
                            <p class="status text-info">En cours</p>
                            <a href="{{ path('app_tournament_match_show', {tournamentId: tournament.id, id: match.id}) }}" class="btn-view">Voir</a>
                        </div>

                    </div>
                {% endif %}
            {% endfor %}

            {% if not hasActive %}
                <p class="empty-text">Aucun match en cours.</p>
            {% endif %}
        </div>

        <hr class="section-separator">


        {# ===================== TERMIN√âS ===================== #}
        <h2 class="section-title">üèÅ Matchs termin√©s</h2>
        <div class="matches-grid">

            {% set hasFinished = false %}
            {% for match in matches %}
                {% if match.score1 is not null and match.score2 is not null and (match.score1 == 0 or match.score2 == 0) %}

                    {% set hasFinished = true %}
                    {% set winner = match.score1 > match.score2 ? match.player1 : match.player2 %}
                    {% set loser  = match.score1 > match.score2 ? match.player2 : match.player1 %}

                    <div class="match-card match-finished">
                        <div class="match-row">

                            {# PLAYER 1 #}
                            <div class="player-side {% if winner.id == match.player1.id %}winner{% else %}loser{% endif %}">
                                <div class="avatar {% if winner.id == match.player1.id %}neon-avatar-blue{% else %}avatar-gray{% endif %}">
                                    <img src="{{ asset('img/avatars/' ~ match.player1.avatar|default('default.png')) }}">
                                </div>
                                <p class="player-name">{{ match.player1.user.pseudo }}</p>
                                <p class="player-hp">{{ match.score1 }} HP</p>
                                <p class="result-label">
                                    {% if winner.id == match.player1.id %}üèÜ Gagnant{% else %}‚ùå Perdant{% endif %}
                                </p>
                            </div>

                            <div class="vs-circle">VS</div>

                            {# PLAYER 2 #}
                            <div class="player-side {% if winner.id == match.player2.id %}winner{% else %}loser{% endif %}">
                                <div class="avatar {% if winner.id == match.player2.id %}neon-avatar-pink{% else %}avatar-gray{% endif %}">
                                    <img src="{{ asset('img/avatars/' ~ match.player2.avatar|default('default.png')) }}">
                                </div>
                                <p class="player-name">{{ match.player2.user.pseudo }}</p>
                                <p class="player-hp">{{ match.score2 }} HP</p>
                                <p class="result-label">
                                    {% if winner.id == match.player2.id %}üèÜ Gagnant{% else %}‚ùå Perdant{% endif %}
                                </p>
                            </div>

                        </div>

                        <div class="match-footer">
                            <p class="status text-success">Termin√©</p>
                            <a href="{{ path('app_tournament_match_show', {tournamentId: tournament.id, id: match.id}) }}" class="btn-view">D√©tails</a>
                        </div>

                    </div>

                {% endif %}
            {% endfor %}

            {% if not hasFinished %}
                <p class="empty-text">Aucun match termin√©.</p>
            {% endif %}

        </div>

    {% endif %}
</section>
{% endblock %}
